<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Super Robo Control!</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.10.1/nipplejs.min.js"></script>
    <style>
        :root {
            --cor-frente: #00ff88;
            --cor-tras: #ffea00;
            --cor-lados: #00d9ff;
            --cor-parar: #ff3131;
            --cor-pino: #bc13fe;
        }

        body { 
            background: #000; color: white; font-family: 'Arial Rounded MT Bold', 'Helvetica', sans-serif;
            margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden;
            user-select: none;
        }

        /* Topo AmigÃ¡vel */
        header { 
            padding: 15px; display: flex; justify-content: space-around; align-items: center; 
            background: #1a1a1a; border-bottom: 4px solid #333;
        }

        #btn-conectar { 
            background: var(--cor-frente); border: none; padding: 12px 25px; border-radius: 50px;
            font-size: 1.2rem; font-weight: bold; cursor: pointer; box-shadow: 0 4px #00a85a;
        }
        #btn-conectar:active { transform: translateY(4px); box-shadow: none; }

        /* Visor de Comandos */
        #painel-comando {
            background: #222; margin: 15px; padding: 10px; border-radius: 20px;
            border: 4px solid #444; text-align: center; flex-shrink: 0;
        }
        #txt-comando { font-size: 3.5rem; margin: 0; text-shadow: 0 0 20px var(--cor-frente); }
        #txt-status { color: #888; text-transform: uppercase; letter-spacing: 2px; font-size: 1rem; }

        /* Sliders Coloridos */
        .area-ajustes { padding: 0 20px; display: flex; flex-direction: column; gap: 15px; }
        .caixa-ajuste { background: #1a1a1a; padding: 10px; border-radius: 15px; border: 2px solid #333; }
        .caixa-ajuste label { display: block; margin-bottom: 5px; font-size: 0.9rem; }
        input[type=range] { width: 100%; height: 15px; border-radius: 10px; cursor: pointer; }

        /* Controles Principais */
        .container-controles { 
            flex-grow: 1; display: flex; justify-content: center; align-items: center; 
            position: relative; margin: 20px 0;
        }

        /* BotÃµes Estilo Gamepad */
        .grid-botoes { display: grid; grid-template-columns: repeat(3, 90px); gap: 15px; }
        .btn-game { 
            width: 90px; height: 90px; border-radius: 20px; border: none; 
            font-size: 2.5rem; color: white; cursor: pointer; background: #333;
            box-shadow: 0 6px #1a1a1a; transition: 0.1s;
        }
        .btn-game:active { transform: translateY(4px); box-shadow: 0 2px #1a1a1a; }
        
        .btn-f { background: var(--cor-frente); box-shadow: 0 6px #00a85a; }
        .btn-b { background: var(--cor-tras); box-shadow: 0 6px #bfae00; color: #000; }
        .btn-l, .btn-r { background: var(--cor-lados); box-shadow: 0 6px #0099b3; }
        .btn-s { background: var(--cor-parar); box-shadow: 0 6px #b32222; }

        /* Alternador de Modo */
        .modo-switch { background: #333; border-radius: 30px; padding: 5px; display: flex; gap: 5px; }
        .btn-modo { background: none; border: none; color: white; padding: 8px 15px; border-radius: 25px; cursor: pointer; }
        .modo-ativo { background: var(--cor-lados); font-weight: bold; }

        .escondido { display: none !important; }
    </style>
</head>
<body>

<header>
    <button id="btn-conectar" onclick="conectarBT()">LIGAR ROBÃ” ðŸ¤–</button>
    <div class="modo-switch">
        <button id="m-pad" class="btn-modo modo-ativo" onclick="mudarModo('pad')">JOYSTICK</button>
        <button id="m-btn" class="btn-modo" onclick="mudarModo('btn')">BOTÃ•ES</button>
    </div>
</header>

<div id="painel-comando">
    <p id="txt-status">Aguardando...</p>
    <h1 id="txt-comando">PARADO</h1>
</div>

<div class="area-ajustes">
    <div class="caixa-ajuste" style="border-color: var(--cor-lados);">
        <label>VELOCIDADE DO MOTOR: <b id="val-v">150</b></label>
        <input type="range" min="0" max="255" value="150" oninput="ajustarV(this.value)">
    </div>
    <div class="caixa-ajuste" style="border-color: var(--cor-pino);">
        <label>ALTURA DO PINO: <b id="val-h">90</b>Â°</label>
        <input type="range" min="0" max="180" value="90" oninput="ajustarH(this.value)">
    </div>
</div>

<div class="container-controles">
    <div id="area-joystick" style="width: 200px; height: 200px;"></div>

    <div id="area-botoes" class="grid-botoes escondido">
        <div></div> <button class="btn-game btn-f" onmousedown="enviar('F')" onmouseup="enviar('S')" ontouchstart="enviar('F')" ontouchend="enviar('S')">â–²</button> <div></div>
        <button class="btn-game btn-l" onmousedown="enviar('L')" onmouseup="enviar('S')" ontouchstart="enviar('L')" ontouchend="enviar('S')">â—€</button>
        <button class="btn-game btn-s" onclick="enviar('S')">â– </button>
        <button class="btn-game btn-r" onmousedown="enviar('R')" onmouseup="enviar('S')" ontouchstart="enviar('R')" ontouchend="enviar('S')">â–¶</button>
        <div></div> <button class="btn-game btn-b" onmousedown="enviar('B')" onmouseup="enviar('S')" ontouchstart="enviar('B')" ontouchend="enviar('S')">â–¼</button> <div></div>
    </div>
</div>

<script>
    let device, char;
    const UUID = '00001101-0000-1000-8000-00805f9b34fb';

    const infos = {
        'F': { t: 'FRENTE', c: 'var(--cor-frente)' },
        'B': { t: 'PARA TRÃS', c: 'var(--cor-tras)' },
        'L': { t: 'ESQUERDA', c: 'var(--cor-lados)' },
        'R': { t: 'DIREITA', c: 'var(--cor-lados)' },
        'S': { t: 'PARADO', c: 'var(--cor-parar)' }
    };

    async function conectarBT() {
        try {
            device = await navigator.bluetooth.requestDevice({ filters: [{ namePrefix: 'HC' }], optionalServices: [UUID] });
            const server = await device.gatt.connect();
            const service = await server.getPrimaryService(UUID);
            char = await service.getCharacteristic(UUID);
            document.getElementById('btn-conectar').innerText = "CONECTADO! ðŸš€";
            document.getElementById('txt-status').innerText = "RobÃ´ pronto para a missÃ£o!";
        } catch (e) { alert("Ops! O Bluetooth nÃ£o ligou."); }
    }

    async function enviar(c) {
        if(infos[c]) {
            document.getElementById('txt-comando').innerText = infos[c].t;
            document.getElementById('txt-comando').style.color = infos[c].c;
            document.getElementById('txt-comando').style.textShadow = `0 0 20px ${infos[c].c}`;
        }
        if (char) {
            const enc = new TextEncoder();
            await char.writeValue(enc.encode(c + '\n'));
        }
    }

    function ajustarV(v) { document.getElementById('val-v').innerText = v; enviar('V' + v); }
    function ajustarH(h) { document.getElementById('val-h').innerText = h; enviar('H' + h); }

    function mudarModo(m) {
        document.getElementById('area-joystick').classList.toggle('escondido', m === 'btn');
        document.getElementById('area-botoes').classList.toggle('escondido', m === 'pad');
        document.getElementById('m-pad').classList.toggle('modo-ativo', m === 'pad');
        document.getElementById('m-btn').classList.toggle('modo-ativo', m === 'btn');
        enviar('S');
    }

    // Inicializa Joystick
    const joy = nipplejs.create({ zone: document.getElementById('area-joystick'), mode: 'static', position: {left: '50%', top: '50%'}, color: 'white', size: 150 });
    joy.on('dir:up', () => enviar('F')); joy.on('dir:down', () => enviar('B'));
    joy.on('dir:left', () => enviar('L')); joy.on('dir:right', () => enviar('R'));
    joy.on('end', () => enviar('S'));

    // Atalhos Teclado
    window.addEventListener('keydown', (e) => {
        const k = { 'ArrowUp':'F', 'ArrowDown':'B', 'ArrowLeft':'L', 'ArrowRight':'R', ' ':'S' };
        if(k[e.key]) enviar(k[e.key]);
    });
    window.addEventListener('keyup', () => enviar('S'));
</script>
</body>
</html>
